function mark_read(a,b){$.ajax({url:"/markRead/"+b,async:!0,method:"POST"}),$(a).attr("class","read")}function autoMark(a,b){$.ajax({url:"/automarkRead/"+a+"/"+b,async:!0,method:"POST",dataType:"json",success:function(a){for(var b=0;b<a.length;b++)$("#"+a[b]).attr("class","read")}})}$(function(){registNewFeed(),feedRefresh(),unpull(),smartpull(),hideFeedlist(),removeHideFeedlistBtn()});var MAXNUM_READFEEDlISTITEM=5,registNewFeed=function(){$("#registNewFeed").submit(function(){var a=$(this).find("input[id=new-feed-url]"),b=a.val();return 0<b.length&&$.ajax({url:"/registNewFeed/",async:!0,type:"POST",data:{url:b},dataType:"json",success:function(b){null!==b&&($("#feed-list-unread").append('<p><a class="unread" href="/feed/'+b.id+'" >'+b.title+"</a></p>"),a.val(""))}}),!1})},feedRefresh=function(){$("#btn-refresh").click(function(){var a=$("#btn-refresh"),b=a.children(),c='<img src="/assets/img/feed_refresh.gif" />';a.attr("disabled",!0),a.empty(),a.append(c),$.ajax({url:"/updateFeed",async:!0,type:"POST",dataType:"json"}).done(function(a){console.log("success: "+a.update_num),location.reload()}).fail(function(){a.empty(),a.append(b)}).always(function(){$("#btn-refresh").attr("disabled",!1),console.log("complete")})})},unpull=function(){$("a.unpull").click(function(){if(0==confirm("購読を解除しますか？"))return!1;var a=$(this).attr("name"),b=$(this).parent();return $.ajax({url:"/unpullFeed",async:!0,method:"POST",data:{fid:a}}).done(function(){b.remove();var c=location.href.match(/feed.[0-9]+/);if(null!=c){var d=c[0].match(/[0-9]+/)[0];parseInt(d)==parseInt(a)&&(window.location.href="/dashboard")}}).fail(function(){}),!1})},smartpull=function(){$(".smart-pull").submit(function(){var a=$(this).find("input").attr("value");return $.ajax({url:"/smartpull",async:!0,type:"POST",data:{feedid:a},dataType:"json"}).done(function(a){0==Array.isArray(a)&&append_feed(a.id,a.title,a.unread_num)}),!1})},append_feed=function(a,b,c){var d=$("<div>").addClass("link-panel"),e=$("<a>").attr("href","/feed/"+a),b=$("<span>").addClass("unread").addClass("feed-title").text(b),f=$("<span>").addClass("badge").text(c);e.append(b).append(f).appendTo(d),$("#feed-list-unread").append(d)},removeHideFeedlistBtn=function(){$("#feed-list-read").children().length<=MAXNUM_READFEEDlISTITEM&&$("#hide button").remove()},hideFeedlist=function(){$("#hide button").click(function(){for(var a=$("#feed-list-read").children().slice(MAXNUM_READFEEDlISTITEM),b=0;b<a.length;b++)$(a[b]).slideToggle(1e3);$("#option").slideToggle(1e3);for(var c=$("#hide button").children(),b=0;b<c.length;b++)$(c[b]).toggle();return!1})};